B) O QUE FAZER NO APP Palpites.AI (PredictionMarket)

Agora vamos fazer a Palpites chamar o 3BIT sempre que tiver:

dep√≥sito PIX (mint)

saque PIX (burn)

1. Ajustar .env da Palpites

No projeto PredictionMarket, abre seu .env e adiciona:

# URL do backend do 3BIT (onde o Express do 3BIT roda)
BRL3_API_URL=http://localhost:3001   # ou o URL p√∫blico do Replit do 3BIT

# Mesma chave que voc√™ colocou no 3BIT
BRL3_API_KEY=super-secreta-troca-isso


Em produ√ß√£o, isso vai ser tipo:
https://brl3-3bit-xchange.<seu-replit-url>.repl.co

2. Criar cliente BRL3 na Palpites

No projeto PredictionMarket, cria um arquivo:

server/brl3-client.ts

E cole isso:

// server/brl3-client.ts
const BRL3_API_URL = process.env.BRL3_API_URL;
const BRL3_API_KEY = process.env.BRL3_API_KEY;

if (!BRL3_API_URL) {
  console.warn("‚ö†Ô∏è BRL3_API_URL n√£o configurada. Integra√ß√£o com 3BIT ficar√° desativada.");
}

if (!BRL3_API_KEY) {
  console.warn("‚ö†Ô∏è BRL3_API_KEY n√£o configurada. Integra√ß√£o com 3BIT ficar√° desativada.");
}

interface PalpitesMintPayload {
  externalUserId: string;
  amountBrl: number;
}

export async function notifyMintToBRL3(payload: PalpitesMintPayload): Promise<void> {
  try {
    if (!BRL3_API_URL || !BRL3_API_KEY) {
      // Integra√ß√£o desativada - n√£o quebra o fluxo da Palpites
      return;
    }

    const res = await fetch(`${BRL3_API_URL}/api/palpites/mint`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": BRL3_API_KEY,
      },
      body: JSON.stringify({
        externalUserId: payload.externalUserId,
        amountBrl: payload.amountBrl.toFixed(2),
      }),
    });

    if (!res.ok) {
      const text = await res.text();
      console.error("‚ùå Falha ao notificar BRL3 (mint):", res.status, text);
    } else {
      console.log(`‚úÖ Notificado BRL3 (mint): user=${payload.externalUserId}, amount=${payload.amountBrl}`);
    }
  } catch (error) {
    console.error("‚ùå Erro ao chamar BRL3 (mint):", error);
  }
}

interface PalpitesBurnPayload {
  externalUserId: string;
  amountBrl: number;
}

export async function notifyBurnToBRL3(payload: PalpitesBurnPayload): Promise<void> {
  try {
    if (!BRL3_API_URL || !BRL3_API_KEY) {
      // Integra√ß√£o desativada - n√£o quebra o fluxo da Palpites
      return;
    }

    const res = await fetch(`${BRL3_API_URL}/api/palpites/burn`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": BRL3_API_KEY,
      },
      body: JSON.stringify({
        externalUserId: payload.externalUserId,
        amountBrl: payload.amountBrl.toFixed(2),
      }),
    });

    if (!res.ok) {
      const text = await res.text();
      console.error("‚ùå Falha ao notificar BRL3 (burn):", res.status, text);
    } else {
      console.log(`üî• Notificado BRL3 (burn): user=${payload.externalUserId}, amount=${payload.amountBrl}`);
    }
  } catch (error) {
    console.error("‚ùå Erro ao chamar BRL3 (burn):", error);
  }
}


Pronto: a Palpites agora sabe como falar com o 3BIT.

3. Integrar no dep√≥sito (/api/wallet/deposit)

Agora abre no projeto PredictionMarket:

server/routes.ts

Voc√™ j√° tem o bloco:

  // POST /api/wallet/deposit - Deposit funds (MOCKED)
  app.post("/api/wallet/deposit", requireAuth, async (req, res) => {
    try {
      // ...
      await storage.updateUserBalance(...);

      await storage.createTransaction(...);

      res.json({ success: true });
    } catch (error: any) {


L√° no topo do arquivo routes.ts, adiciona o import:

import { notifyMintToBRL3, notifyBurnToBRL3 } from "./brl3-client";


Dentro da rota de dep√≥sito, logo depois de:

      await storage.updateUserBalance(user.id, newBalanceBrl, newBalanceUsdc);
      
      await storage.createTransaction(user.id, {
        type: type as any,
        amount: depositAmount.toString(),
        currency,
        description: `Deposited ${depositAmount} ${currency} (MOCKED)`,
      });


Cole isto logo abaixo:

      // Integra√ß√£o com BRL3 (3BIT XChange) - apenas para dep√≥sitos em BRL via PIX
      if (currency === "BRL" && type === "deposit_pix") {
        // user.id √© o ID interno da Palpites
        const amountNumber = typeof depositAmount === "number"
          ? depositAmount
          : parseFloat(depositAmount.toString());

        if (!Number.isNaN(amountNumber) && amountNumber > 0) {
          await notifyMintToBRL3({
            externalUserId: user.id,
            amountBrl: amountNumber,
          });
        }
      }


Assim:

Usu√°rio depositou BRL via PIX na Palpites.

Palpites aumenta saldo.

Palpites avisa o 3BIT: ‚Äúmint BRL3 para este usu√°rio‚Äù (no ledger).

4. Integrar no saque (/api/wallet/withdraw)

Ainda em server/routes.ts, na rota:

  // POST /api/wallet/withdraw - Withdraw funds (MOCKED)
  app.post("/api/wallet/withdraw", requireAuth, async (req, res) => {
    try {
      // ...
      await storage.updateUserBalance(user.id, newBalanceBrl, newBalanceUsdc);
      
      await storage.createTransaction(user.id, {
        type: type as any,
        amount: withdrawAmount.toString(),
        currency,
        description: `Withdrew ${withdrawAmount} ${currency} (MOCKED)`,
      });

      res.json({
        success: true,


Logo depois do createTransaction, cola:

      // Integra√ß√£o com BRL3 (3BIT XChange) - apenas para saques em BRL via PIX
      if (currency === "BRL" && type === "withdrawal_pix") {
        const amountNumber = typeof withdrawAmount === "number"
          ? withdrawAmount
          : parseFloat(withdrawAmount.toString());

        if (!Number.isNaN(amountNumber) && amountNumber > 0) {
          await notifyBurnToBRL3({
            externalUserId: user.id,
            amountBrl: amountNumber,
          });
        }
      }


Resultado:

Usu√°rio pediu saque em BRL via PIX.

Palpites debita o saldo.

Palpites avisa o 3BIT: ‚Äúqueima BRL3 desse usu√°rio‚Äù (no ledger).

C) COMO ISSO FICA NA SUA CABE√áA (SUPER SIMPLIFICADO)

Dep√≥sito:

Palpites: +R$100 no saldo do usu√°rio

3BIT: ledger: Bank:BRL3 ‚Üí PalpitesUser:<id>:BRL3 (100)

Saque:

Palpites: -R$100 no saldo do usu√°rio

3BIT: ledger: PalpitesUser:<id>:BRL3 ‚Üí Bank:BRL3 (100)

Voc√™ ainda est√° na fase em que o token n√£o tem liquidez nem lastro perfeito, mas:

Na pr√°tica, voc√™ j√° tem:

contabilidade dupla bonitinha,

integra√ß√£o entre os dois sistemas,

caminho pronto para, quando quiser, ligar:

Fireblocks

contrato novo BRL3

PSP real de PIX.