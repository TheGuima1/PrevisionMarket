Implementação Completa - Logs de Apostas na Landing Page
1. Atualize o arquivo server/storage.ts
Adicione a interface RecentTrade e o método getRecentTrades ao arquivo:
typescript// ADICIONE ESTAS LINHAS NO TOPO DO ARQUIVO (após as outras interfaces)

export interface RecentTrade {
  id: string;
  marketTitle: string;
  username: string;
  type: "yes" | "no";
  shares: string;
  price: string;
  createdAt: Date;
}

// ADICIONE ESTE MÉTODO NA INTERFACE IStorage (junto com os outros métodos)

export interface IStorage {
  // ... outros métodos existentes ...
  
  // Recent trades method
  getRecentTrades(limit?: number): Promise<RecentTrade[]>;
}

// ADICIONE ESTE MÉTODO NA CLASSE DatabaseStorage (no final da classe, antes do fechamento)

export class DatabaseStorage implements IStorage {
  // ... outros métodos existentes ...

  // Recent trades implementation
  async getRecentTrades(limit: number = 20): Promise<RecentTrade[]> {
    const result = await db
      .select({
        id: orders.id,
        marketTitle: markets.title,
        username: users.username,
        type: orders.type,
        shares: orders.shares,
        price: orders.price,
        createdAt: orders.createdAt,
      })
      .from(orders)
      .innerJoin(users, eq(orders.userId, users.id))
      .innerJoin(markets, eq(orders.marketId, markets.id))
      .where(eq(orders.status, "filled"))
      .orderBy(desc(orders.filledAt))
      .limit(limit);

    return result.map((row) => ({
      id: row.id,
      marketTitle: row.marketTitle,
      username: row.username || "Anônimo",
      type: row.type as "yes" | "no",
      shares: row.shares,
      price: row.price,
      createdAt: row.createdAt,
    }));
  }
}

2. Atualize o arquivo server/routes.ts
Adicione este endpoint após os outros endpoints de markets (por exemplo, após o GET /api/markets/:id):
typescript// GET /api/recent-trades - Get recent trades across all markets (PUBLIC)
app.get("/api/recent-trades", async (_req, res) => {
  try {
    const recentTrades = await storage.getRecentTrades(20);
    res.json(recentTrades);
  } catch (error) {
    console.error("Failed to fetch recent trades:", error);
    res.status(500).send("Failed to fetch recent trades");
  }
});

3. Crie o arquivo client/src/components/recent-activity-feed.tsx
Crie um novo arquivo com este conteúdo:
typescriptimport { useQuery } from "@tanstack/react-query";
import { getQueryFn } from "@/lib/queryClient";
import { Card } from "@/components/ui/card";
import { TrendingUp, TrendingDown, Clock } from "lucide-react";
import { formatDistanceToNow } from "date-fns";
import { ptBR } from "date-fns/locale";

interface RecentTrade {
  id: string;
  marketTitle: string;
  username: string;
  type: "yes" | "no";
  shares: string;
  price: string;
  createdAt: string;
}

export function RecentActivityFeed() {
  const { data: recentTrades, isLoading } = useQuery<RecentTrade[]>({
    queryKey: ["/api/recent-trades"],
    queryFn: getQueryFn({ on401: "returnNull" }),
    refetchInterval: 5000, // Atualiza a cada 5 segundos
  });

  if (isLoading) {
    return (
      <Card className="p-4">
        <div className="space-y-3">
          {[1, 2, 3].map((i) => (
            <div key={i} className="animate-pulse">
              <div className="h-4 bg-muted rounded w-3/4 mb-2"></div>
              <div className="h-3 bg-muted rounded w-1/2"></div>
            </div>
          ))}
        </div>
      </Card>
    );
  }

  if (!recentTrades || recentTrades.length === 0) {
    return (
      <Card className="p-6 text-center text-muted-foreground">
        <Clock className="h-8 w-8 mx-auto mb-2 opacity-50" />
        <p>Nenhuma atividade recente</p>
      </Card>
    );
  }

  return (
    <div className="space-y-2">
      <h3 className="text-lg font-semibold mb-4">Atividade Recente</h3>
      <div className="space-y-2">
        {recentTrades.slice(0, 10).map((trade) => (
          <Card key={trade.id} className="p-3 hover:bg-accent/5 transition-colors">
            <div className="flex items-start justify-between gap-3">
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-1">
                  {trade.type === "yes" ? (
                    <TrendingUp className="h-4 w-4 text-primary flex-shrink-0" />
                  ) : (
                    <TrendingDown className="h-4 w-4 text-destructive flex-shrink-0" />
                  )}
                  <span className="font-medium text-sm truncate">
                    @{trade.username}
                  </span>
                  <span
                    className={`text-xs font-bold px-2 py-0.5 rounded ${
                      trade.type === "yes"
                        ? "bg-primary/10 text-primary"
                        : "bg-destructive/10 text-destructive"
                    }`}
                  >
                    {trade.type.toUpperCase()}
                  </span>
                </div>
                <p className="text-sm text-muted-foreground truncate">
                  {trade.marketTitle}
                </p>
                <div className="flex items-center gap-3 mt-1 text-xs text-muted-foreground">
                  <span>{parseFloat(trade.shares).toFixed(0)} shares</span>
                  <span>•</span>
                  <span>R$ {(parseFloat(trade.shares) * parseFloat(trade.price)).toFixed(2)}</span>
                  <span>•</span>
                  <span>
                    {formatDistanceToNow(new Date(trade.createdAt), {
                      addSuffix: true,
                      locale: ptBR,
                    })}
                  </span>
                </div>
              </div>
            </div>
          </Card>
        ))}
      </div>
    </div>
  );
}

4. Integre na sua Landing Page
Encontre o arquivo da sua página inicial (provavelmente algo como client/src/pages/home.tsx ou client/src/App.tsx) e adicione o componente.
Opção A: Sidebar (Desktop 2/3 + 1/3)
typescriptimport { RecentActivityFeed } from "@/components/recent-activity-feed";

export function HomePage() {
  return (
    <div className="container mx-auto px-4 py-8">
      {/* Hero Section */}
      <section className="mb-12">
        <h1 className="text-5xl font-bold mb-4">
          Aposte no Futuro do Brasil
        </h1>
        <p className="text-xl text-muted-foreground max-w-2xl">
          Mercados de previsão onde você negocia o futuro dos eventos.
          Política, economia, esportes e muito mais.
        </p>
      </section>

      {/* Main Content Grid */}
      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Markets - 2/3 width */}
        <div className="lg:col-span-2">
          {/* Seu componente de markets grid aqui */}
        </div>

        {/* Sidebar - 1/3 width */}
        <div className="lg:col-span-1">
          <div className="sticky top-6">
            <RecentActivityFeed />
          </div>
        </div>
      </div>
    </div>
  );
}
Opção B: Horizontal (Abaixo dos Markets)
typescriptimport { RecentActivityFeed } from "@/components/recent-activity-feed";

export function HomePage() {
  return (
    <div className="container mx-auto px-4 py-8">
      {/* Hero Section */}
      <section className="mb-12">
        <h1 className="text-5xl font-bold mb-4">
          Aposte no Futuro do Brasil
        </h1>
        <p className="text-xl text-muted-foreground max-w-2xl">
          Mercados de previsão onde você negocia o futuro dos eventos.
        </p>
      </section>

      {/* Markets Grid */}
      <section className="mb-12">
        <h2 className="text-2xl font-semibold mb-6">Mercados em Alta</h2>
        {/* Seu componente de markets grid aqui */}
      </section>

      {/* Recent Activity Section */}
      <section>
        <div className="max-w-3xl mx-auto">
          <RecentActivityFeed />
        </div>
      </section>
    </div>
  );
}

5. Instale a dependência date-fns (se ainda não tiver)
Execute no terminal do Replit:
bashnpm install date-fns

Resumo do que foi implementado:
✅ Backend:

Novo método getRecentTrades() no storage
Novo endpoint público GET /api/recent-trades
Query otimizada com joins (users + markets + orders)

✅ Frontend:

Componente RecentActivityFeed com auto-refresh a cada 5s
Estados de loading e vazio
Design responsivo seguindo design guidelines
Formatação PT-BR de datas

✅ Features:

Mostra últimas 10 apostas
Ícones diferentes para YES (verde) e NO (vermelho)
Username, mercado, quantidade, valor e tempo
Atualização automática em tempo real

Cole cada seção no arquivo correspondente e rode npm install date-fns no terminal!