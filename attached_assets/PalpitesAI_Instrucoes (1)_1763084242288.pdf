%PDF-1.4
1 0 obj
<< /Type /Catalog /Pages 2 0 R >>
endobj
2 0 obj
<< /Type /Pages /Kids [3 0 R] /Count 1 >>
endobj
3 0 obj
<< /Type /Page /Parent 2 0 R /MediaBox [0 0 612 792] /Contents 5 0 R /Resources << /Font << /F1 4 0 R >> >> >>
endobj
4 0 obj
<< /Type /Font /Subtype /Type1 /BaseFont /Helvetica >>
endobj
5 0 obj
<< /Length 7228 >>
stream
BT
/F1 10 Tf
50 770 Td
() Tj
50 758 Td
(Palpites.AI \(PredictionMarket\) - Guia de Integração de Depósitos com BRL3 XChange) Tj
50 746 Td
() Tj
50 734 Td
(## Visão Geral) Tj
50 722 Td
() Tj
50 710 Td
(Palpites.AI é um app de mercado de previsões em que os usuários depositam BRL3 para participar. Para) Tj
50 698 Td
(integrar depósitos de forma automática com o backend BRL3 XChange, precisaremos adicionar novos) Tj
50 686 Td
(endpoints e lógicas. O saldo exibido aos usuários virá de uma carteira "mãe" \(admin\) na blockchain;) Tj
50 674 Td
(os usuários não possuem carteiras individuais, apenas um registro interno de saldo.) Tj
50 662 Td
() Tj
50 650 Td
(## Estrutura Recomendada) Tj
50 638 Td
() Tj
50 626 Td
(- Backend \(Node/Express ou Next.js API routes\): responsável por receber pedidos de depósito,) Tj
50 614 Td
(armazenar comprovantes, aprovar depósitos e atualizar saldos.) Tj
50 602 Td
(- Banco de dados: tabelas `users` \(id, email, balance\), `deposits` \(id, userId, amount, proofPath,) Tj
50 590 Td
(status, createdAt, updatedAt\).) Tj
50 578 Td
(- Frontend: telas para enviar um depósito e área de admin para aprovar.) Tj
50 566 Td
(- Integração com BRL3 XChange: chamadas HTTP autenticadas aos endpoints de mint/burn do outro app.) Tj
50 554 Td
() Tj
50 542 Td
(## 1. Endpoint de Depósito) Tj
50 530 Td
() Tj
50 518 Td
(Crie uma rota POST `/api/deposit` que aceite `amount` e um arquivo de comprovante de depósito. Use o) Tj
50 506 Td
(middleware `multer` para upload de arquivos. O endpoint deverá:) Tj
50 494 Td
() Tj
50 482 Td
(1. Autenticar o usuário \(via sessão, JWT etc.\).) Tj
50 470 Td
(2. Receber o valor \(`amount`\) e o arquivo \(`proof`\).) Tj
50 458 Td
(3. Salvar o arquivo em disco \(ex.: `uploads/`\), registrar no banco um novo registro na tabela) Tj
50 446 Td
(`deposits` com status `pending`.) Tj
50 434 Td
(4. Retornar ao usuário uma mensagem de "Depósito submetido para aprovação".) Tj
50 422 Td
() Tj
50 410 Td
(### Exemplo de código Express) Tj
50 398 Td
() Tj
50 386 Td
(```) Tj
50 374 Td
(const express = require\('express'\);) Tj
50 362 Td
(const multer = require\('multer'\);) Tj
50 350 Td
(const router = express.Router\(\);) Tj
50 338 Td
(const upload = multer\({ dest: 'uploads/' }\);) Tj
50 326 Td
(const { Deposit, User } = require\('./models'\);) Tj
50 314 Td
() Tj
50 302 Td
(router.post\('/api/deposit', authMiddleware, upload.single\('proof'\), async \(req, res\) => {) Tj
50 290 Td
(  const { amount } = req.body;) Tj
50 278 Td
(  if \(!amount\) return res.status\(400\).json\({ error: 'amount é obrigatório' }\);) Tj
50 266 Td
(  const proofFile = req.file;) Tj
50 254 Td
(  const deposit = await Deposit.create\({) Tj
50 242 Td
(    userId: req.user.id,) Tj
50 230 Td
(    amount: parseFloat\(amount\),) Tj
50 218 Td
(    proofPath: proofFile.path,) Tj
50 206 Td
(    status: 'pending') Tj
50 194 Td
(  }\);) Tj
50 182 Td
(  res.json\({ message: 'Depósito enviado', depositId: deposit.id }\);) Tj
50 170 Td
(}\);) Tj
50 158 Td
(```) Tj
50 146 Td
() Tj
50 134 Td
(## 2. Interface de Aprovação de Depósitos) Tj
50 122 Td
() Tj
50 110 Td
(Crie uma rota GET `/api/admin/deposits` que liste depósitos com status `pending`. Crie também uma) Tj
50 98 Td
(rota POST `/api/admin/deposits/:id/approve` para aprovação. Apenas administradores autenticados) Tj
50 86 Td
(podem acessar essas rotas.) Tj
50 74 Td
() Tj
50 62 Td
(### Exemplo de código de aprovação) Tj
50 50 Td
() Tj
50 38 Td
(```) Tj
50 26 Td
(router.post\('/api/admin/deposits/:id/approve', adminMiddleware, async \(req, res\) => {) Tj
50 14 Td
(  const deposit = await Deposit.findByPk\(req.params.id\);) Tj
50 2 Td
(  if \(!deposit\) return res.status\(404\).json\({ error: 'Depósito não encontrado' }\);) Tj
50 -10 Td
(  if \(deposit.status !== 'pending'\) return res.status\(400\).json\({ error: 'Depósito já processado') Tj
50 -22 Td
(}\);) Tj
50 -34 Td
(  // Chama a API de mint do BRL3 XChange) Tj
50 -46 Td
(  const response = await fetch\(`${process.env.BRL3_XCHANGE_URL}/api/mint`, {) Tj
50 -58 Td
(    method: 'POST',) Tj
50 -70 Td
(    headers: {) Tj
50 -82 Td
(      'Content-Type': 'application/json',) Tj
50 -94 Td
(      'Authorization': `Bearer ${process.env.BRL3_XCHANGE_TOKEN}`) Tj
50 -106 Td
(    },) Tj
50 -118 Td
(    body: JSON.stringify\({ userId: deposit.userId, amount: deposit.amount }\)) Tj
50 -130 Td
(  }\);) Tj
50 -142 Td
(  const data = await response.json\(\);) Tj
50 -154 Td
(  if \(!response.ok\) {) Tj
50 -166 Td
(    return res.status\(500\).json\({ error: 'Mint falhou', details: data }\);) Tj
50 -178 Td
(  }) Tj
50 -190 Td
(  // Atualiza o status e saldo) Tj
50 -202 Td
(  deposit.status = 'approved';) Tj
50 -214 Td
(  await deposit.save\(\);) Tj
50 -226 Td
(  await User.increment\({ balance: deposit.amount }, { where: { id: deposit.userId } }\);) Tj
50 -238 Td
(  res.json\({ message: 'Depósito aprovado e tokens mintados', txHash: data.txHash }\);) Tj
50 -250 Td
(}\);) Tj
50 -262 Td
(```) Tj
50 -274 Td
() Tj
50 -286 Td
(## 3. Atualização de Saldo) Tj
50 -298 Td
() Tj
50 -310 Td
(Toda vez que o admin aprovar um depósito ou executar um burn \(saque\), atualize a coluna `balance` do) Tj
50 -322 Td
(usuário. Para exibir o saldo no frontend, crie um endpoint GET `/api/balance` que retorne o saldo do) Tj
50 -334 Td
(usuário autenticado a partir da coluna `balance`.) Tj
50 -346 Td
() Tj
50 -358 Td
(## 4. Integração com BRL3 XChange) Tj
50 -370 Td
() Tj
50 -382 Td
(- Defina variáveis de ambiente `BRL3_XCHANGE_URL` \(endereço da API\) e `BRL3_XCHANGE_TOKEN` \(chave de) Tj
50 -394 Td
(autenticação\). O BRL3 XChange deverá validar esse token em seus endpoints.) Tj
50 -406 Td
(- Use `fetch` ou `axios` para realizar as chamadas.) Tj
50 -418 Td
(- Em caso de falhas de mint, trate adequadamente e notifique o admin.) Tj
50 -430 Td
() Tj
50 -442 Td
(## 5. Carteira Mãe \(Admin Wallet\)) Tj
50 -454 Td
() Tj
50 -466 Td
(Todos os tokens BRL3 dos usuários ficam em uma única carteira controlada pelo admin. Ao aprovar um) Tj
50 -478 Td
(depósito, a API de mint do BRL3 XChange mintará tokens para essa carteira e atualizará o saldo) Tj
50 -490 Td
(interno do usuário. Os usuários não possuem chaves privadas nem endereços na blockchain. Para) Tj
50 -502 Td
(saques, você precisará implementar um endpoint similar para burn.) Tj
50 -514 Td
() Tj
50 -526 Td
(## 6. Segurança e Validação) Tj
50 -538 Td
() Tj
50 -550 Td
(- Implemente autenticação e autorização robustas nos endpoints de admin.) Tj
50 -562 Td
(- Valide valores de depósito \(`amount` deve ser positivo e numérico\) e tamanho/formato de arquivos.) Tj
50 -574 Td
(- Armazene comprovantes de depósito de forma segura e verifique se são acessíveis somente pelo) Tj
50 -586 Td
(admin.) Tj
50 -598 Td
() Tj
50 -610 Td
(## 7. Próximos Passos) Tj
50 -622 Td
() Tj
50 -634 Td
(1. Ajustar o frontend para permitir upload de comprovante e exibir status do depósito.) Tj
50 -646 Td
(2. Criar dashboard para o admin revisar depósitos pendentes.) Tj
50 -658 Td
(3. Integrar com o endpoint de balance do BRL3 XChange \(caso necessário\) para manter dados) Tj
50 -670 Td
(sincronizados.) Tj
50 -682 Td
(4. Testar o fluxo completo: envio de depósito, aprovação, mint no BRL3 XChange, saldo atualizado.) Tj
50 -694 Td
() Tj
ET
endstream
endobj
xref
0 6
0000000000 65535 f 
0000000009 00000 n 
0000000058 00000 n 
0000000115 00000 n 
0000000241 00000 n 
0000000311 00000 n 
trailer
<< /Size 6 /Root 1 0 R >>
startxref
7591
%%EOF