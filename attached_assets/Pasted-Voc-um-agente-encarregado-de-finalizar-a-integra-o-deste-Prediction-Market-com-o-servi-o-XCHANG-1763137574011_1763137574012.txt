Você é um agente encarregado de finalizar a integração deste Prediction Market
com o serviço XCHANGE on-chain.

Siga tudo exatamente como descrito.

======================================================
(1) DEFINIR URL DO XCHANGE
======================================================

Crie o secret:
XCHANGE_URL=https://SEU_XCHANGE_REPLIT_URL

======================================================
(2) FLUXO DO DEPÓSITO
======================================================

Depósito funciona assim:

1. Usuário envia valor + comprovante PIX.
2. Registro é salvo no banco (ledger off-chain).
3. Admin acessa painel e aperta "Aprovar".
4. O Prediction Market chama automaticamente:

POST ${XCHANGE_URL}/api/mint
{ "amount": valorEmWei }

5. Após sucesso → atualizar saldo interno do cliente:
users.balance += amount

======================================================
(3) IMPLEMENTAR A CHAMADA AO XCHANGE
======================================================

No arquivo que executa a aprovação de depósito (ex.: src/routes/depositApprove.ts),
substitua por:

import axios from "axios";

router.post("/approve", async (req, res) => {
  const { userId, amount } = req.body;

  try {
    await axios.post(`${process.env.XCHANGE_URL}/api/mint`, {
      amount
    });

    await db.users.updateBalance(userId, amount);

    res.json({ status: "success" });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


======================================================
(4) FLUXO DO SAQUE
======================================================

1. Usuário solicita saque.
2. Admin aprova no painel.
3. Prediction Market chama:

POST ${XCHANGE_URL}/api/burn

4. Ledger off-chain é atualizado:
users.balance -= amount


======================================================
(5) FUNÇÃO DE BURN
======================================================

No arquivo src/routes/withdrawApprove.ts:

import axios from "axios";

router.post("/approve", async (req, res) => {
  const { userId, amount } = req.body;

  try {
    await axios.post(`${process.env.XCHANGE_URL}/api/burn`, {
      amount
    });

    await db.users.updateBalance(userId, -amount);

    res.json({ status: "success" });
  } catch (err) {
    res.status(500).json({ error: err.message });
  }
});


======================================================
(6) GARANTIR QUE TUDO É OFF-CHAIN
======================================================

1. Ledger interno deve conter:
   - users table (id, name, balance)
   - transactions table (id, userId, type, amount, status)

2. Nenhum usuário deve interagir diretamente com blockchain.

3. Apenas o Admin → Prediction → XChange.


======================================================
(7) TESTAR O FLUXO COMPLETO
======================================================

TESTE 1 — DEPÓSITO
- usuário cria depósito
- admin aprova
- Prediction chama XChange
- mint ocorre
- ledger atualiza

TESTE 2 — SAQUE
- usuário solicita saque
- admin aprova
- Prediction chama XChange
- burn ocorre
- ledger atualiza


======================================================
(8) RESULTADO FINAL
======================================================

Após executar tudo:
- Prediction Market estará 100% integrado ao XCHANGE.
- depósitos/salvos/saldos serão off-chain
- mint/burn será sempre na carteira-mãe.
