Perfeito â€” aqui vai um **sistema COMPLETO e SIMPLES de â€œForgot Passwordâ€**, totalmente copiÃ¡vel, usando:

* **Next.js (React)**
* **Node.js API**
* **SQLite ou Postgres (nÃ£o importa)**
* **JWT token para reset**
* **Envio de e-mail simulado** (vocÃª troca depois por SendGrid / Resend / Mailgun)
* **Fluxo 100% funcional e direto**

O sistema funciona assim:

1. UsuÃ¡rio clica **â€œEsqueci minha senhaâ€**
2. Insere e-mail
3. Se existir â†’ gera token â†’ envia link
4. Se nÃ£o existir â†’ mostra mensagem â€œusuÃ¡rio nÃ£o encontradoâ€
5. UsuÃ¡rio clica no link â†’ abre pÃ¡gina de redefiniÃ§Ã£o
6. Digita nova senha
7. API atualiza no banco â†’ mostra sucesso

---

# âœ… **PARTE 1 â€” BACKEND (API)**

Crie uma pasta `server/auth` com:

---

## **ğŸ“Œ 1.1. Rota: solicitar reset (`POST /auth/request-reset`)**

```ts
// server/auth/request-reset.ts
import { db } from "../db";
import jwt from "jsonwebtoken";

export async function requestReset(req, res) {
  const { email } = req.body;

  // 1. Verifica se usuÃ¡rio existe
  const user = await db.user.findUnique({ where: { email } });

  if (!user) {
    return res.status(404).json({ error: "UsuÃ¡rio nÃ£o cadastrado." });
  }

  // 2. Gera token JWT vÃ¡lido por 1 hora
  const token = jwt.sign(
    { userId: user.id },
    process.env.JWT_SECRET,
    { expiresIn: "1h" }
  );

  // 3. Gera URL de reset
  const resetUrl = `${process.env.FRONTEND_URL}/reset-password?token=${token}`;

  // 4. Envia e-mail (simulado)
  console.log("ğŸ“§ LINK DE RESET:", resetUrl);

  return res.json({
    success: true,
    message: "Um link de reset de senha foi enviado para o seu email."
  });
}
```

---

## **ğŸ“Œ 1.2. Rota: redefinir senha (`POST /auth/reset-password`)**

```ts
// server/auth/reset-password.ts
import { db } from "../db";
import bcrypt from "bcrypt";
import jwt from "jsonwebtoken";

export async function resetPassword(req, res) {
  const { token, newPassword } = req.body;

  try {
    // 1. Valida o token
    const decoded: any = jwt.verify(token, process.env.JWT_SECRET);

    // 2. Hash da nova senha
    const hashedPassword = await bcrypt.hash(newPassword, 10);

    // 3. Atualiza banco
    await db.user.update({
      where: { id: decoded.userId },
      data: { password: hashedPassword }
    });

    return res.json({ success: true, message: "Senha atualizada com sucesso." });

  } catch (error) {
    return res.status(400).json({ error: "Token invÃ¡lido ou expirado." });
  }
}
```

---

# âœ… **PARTE 2 â€” FRONTEND**

---

## **ğŸ“Œ 2.1. PÃ¡gina: â€œEsqueci minha senhaâ€ (`/forgot-password`)**

```tsx
// pages/forgot-password.tsx
import { useState } from "react";

export default function ForgotPassword() {
  const [email, setEmail] = useState("");
  const [msg, setMsg] = useState("");

  async function handleSubmit(e) {
    e.preventDefault();

    const res = await fetch("/api/auth/request-reset", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email })
    });

    const data = await res.json();
    setMsg(data.error || data.message);
  }

  return (
    <div className="max-w-md mx-auto mt-20 p-6 bg-white rounded-xl shadow">
      <h1 className="text-xl font-semibold mb-4">Esqueci minha senha</h1>

      <form onSubmit={handleSubmit}>
        <input
          className="w-full p-3 border rounded mb-4"
          type="email"
          placeholder="Digite seu email"
          value={email}
          onChange={(e) => setEmail(e.target.value)}
        />

        <button className="w-full bg-purple-600 text-white p-3 rounded">
          Enviar link de redefiniÃ§Ã£o
        </button>
      </form>

      {msg && <p className="mt-4 text-gray-700">{msg}</p>}
    </div>
  );
}
```

---

## **ğŸ“Œ 2.2. PÃ¡gina: â€œReset Passwordâ€ (`/reset-password`)**

```tsx
// pages/reset-password.tsx
import { useState } from "react";
import { useRouter } from "next/router";

export default function ResetPassword() {
  const router = useRouter();
  const { token } = router.query;

  const [password, setPassword] = useState("");
  const [msg, setMsg] = useState("");

  async function handleSubmit(e) {
    e.preventDefault();

    const res = await fetch("/api/auth/reset-password", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ token, newPassword: password })
    });

    const data = await res.json();
    setMsg(data.error || data.message);
  }

  return (
    <div className="max-w-md mx-auto mt-20 p-6 bg-white rounded-xl shadow">
      <h1 className="text-xl font-semibold mb-4">Definir nova senha</h1>

      <form onSubmit={handleSubmit}>
        <input
          className="w-full p-3 border rounded mb-4"
          type="password"
          placeholder="Nova senha"
          value={password}
          onChange={(e) => setPassword(e.target.value)}
        />

        <button className="w-full bg-purple-600 text-white p-3 rounded">
          Salvar nova senha
        </button>
      </form>

      {msg && <p className="mt-4 text-gray-700">{msg}</p>}
    </div>
  );
}
```

---

# âœ… **PARTE 3 â€” API ROUTES DO NEXT.JS**

Na pasta:
`/pages/api/auth/request-reset.ts`

```ts
import { requestReset } from "../../../server/auth/request-reset";

export default function handler(req, res) {
  if (req.method === "POST") return requestReset(req, res);
  return res.status(405).json({ error: "Method not allowed" });
}
```

E:
`/pages/api/auth/reset-password.ts`

```ts
import { resetPassword } from "../../../server/auth/reset-password";

export default function handler(req, res) {
  if (req.method === "POST") return resetPassword(req, res);
  return res.status(405).json({ error: "Method not allowed" });
}
```

---

# ğŸ” **PARTE 4 â€” VariÃ¡veis de Ambiente**

No `.env`:

```env
JWT_SECRET=uma_chave_secreta_forte_123
FRONTEND_URL=http://localhost:3000
```

---

# ğŸ§ª **TESTE DO FLUXO**

### 1. Ir para

`/forgot-password`

Inserir e-mail.

Se existir â†’ retorna mensagem â€œemail enviadoâ€.

O terminal mostrarÃ¡:

```
ğŸ“§ LINK DE RESET: http://localhost:3000/reset-password?token=abc123
```

### 2. Acessar o link

PÃ¡gina `/reset-password?token=abc123`

Inserir nova senha.

### 3. Banco de dados Ã© atualizado.

---

# ğŸ‰ PRONTO

Um sistema **completo**, seguro, simples, funcional, jÃ¡ pronto pra integrar com:

* SendGrid
* Resend
* AWS SES
* Clerk/Auth0 (se quiser futuramente)

Se quiser, posso montar:

âœ” versÃ£o com shadcn/ui
âœ” design fintech clean
âœ” animaÃ§Ãµes e layouts roxos
âœ” integraÃ§Ã£o com seu banco atual da Palpites.AI (drizzle)

Ã‰ sÃ³ pedir.
